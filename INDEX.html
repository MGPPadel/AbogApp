<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>AbogApp</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f9f9f9; }
    header { background: #2c3e50; color: white; padding: 1rem; text-align: center; }
    main { padding: 2rem; }
    .card { background: white; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); padding: 1rem; margin-bottom: 1.5rem; }
    h2 { margin-top: 0; }
    input { padding: 8px; margin: 5px 0; width: 100%; }
    button { padding: 8px 16px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background: #2980b9; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { padding: 8px; border: 1px solid #ddd; text-align: left; }
    th { background: #f4f4f4; }
    #logoutBtn { background: #e74c3c; }
    #logoutBtn:hover { background: #c0392b; }
  </style>
</head>
<body>

  <header>
    <h1>📚 AbogApp</h1>
  </header>

  <main>
    <!-- Login -->
    <div id="loginCard" class="card">
      <h2>Iniciar Sesión</h2>
      <input type="text" id="user" placeholder="Usuario">
      <input type="password" id="pass" placeholder="Contraseña">
      <button onclick="loginBackend()">Login</button>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" style="display:none;">
      <div class="card">
        <h2>Panel de Control</h2>
        <p>👤 Usuario: <span id="currentUser"></span></p>
        <p>✅ Estado: Conectado</p>
        <button id="logoutBtn" onclick="logout()">Cerrar Sesión</button>
      </div>

      <div class="card">
        <h2>Resumen Rápido</h2>
        <p>Total de Juicios: <span id="totalJuicios">0</span></p>
        <p>Total de Clientes: <span id="totalClientes">0</span></p>
      </div>

      <div class="card">
        <h2>Listado de Alumnos/Clientes</h2>
        <table>
          <thead>
            <tr><th>Nombre</th><th>Juicio</th></tr>
          </thead>
          <tbody id="tablaClientes"></tbody>
        </table>
      </div>
    </div>
  </main>

  <script>
    const API_BASE = "https://TU_BACKEND_ON_RAILWAY.up.railway.app"; 
    let token = null;

    async function loginBackend(){
      const username = document.getElementById('user').value;
      const password = document.getElementById('pass').value;
      try{
        const res = await fetch(API_BASE + '/login',{
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ username, password })
        });
        if(!res.ok) throw new Error('Login');
        const data = await res.json();
        token = data.token;
        localStorage.setItem('jwt', token);
        localStorage.setItem('user', username);
        setAuthUI();
        alert('✅ Login correcto');
      }catch(e){
        token = null; localStorage.removeItem('jwt'); setAuthUI();
        alert('❌ Usuario o contraseña incorrectos');
      }
    }

    function logout(){
      token = null;
      localStorage.removeItem('jwt');
      localStorage.removeItem('user');
      setAuthUI();
    }

    function setAuthUI(){
      const user = localStorage.getItem('user');
      if(localStorage.getItem('jwt')){
        document.getElementById('loginCard').style.display = 'none';
        document.getElementById('dashboard').style.display = 'block';
        document.getElementById('currentUser').innerText = user;
        cargarDatos();
      } else {
        document.getElementById('loginCard').style.display = 'block';
        document.getElementById('dashboard').style.display = 'none';
      }
    }

    async function cargarDatos(){
      try{
        const res = await fetch(API_BASE + '/clientes',{
          headers:{'Authorization': 'Bearer ' + localStorage.getItem('jwt')}
        });
        const clientes = await res.json();
        document.getElementById('totalClientes').innerText = clientes.length;
        document.getElementById('totalJuicios').innerText = clientes.reduce((acc,c)=> acc + (c.juicio ? 1:0),0);

        let html = "";
        clientes.forEach(c=>{
          html += `<tr><td>${c.nombre}</td><td>${c.juicio || "-"}</td></tr>`;
        });
        document.getElementById('tablaClientes').innerHTML = html;
      }catch(e){
        console.error("Error cargando datos", e);
      }
    }

    setAuthUI();
  </script>
</body>
</html>
